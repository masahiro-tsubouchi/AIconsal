---
trigger: always_on
---

# AI駆動開発用Windsurfルールセット

> **プロジェクト**: 製造業向けAI Chatbot  
> **技術スタック**: FastAPI + React + LangGraph + Gemini API  
> **開発手法**: TDD + AI駆動開発  
> **最終更新**: 2025-08-30

## 1. AI駆動開発基本原則

### 1.1 インクリメンタル開発
- **小さな単位での実装**: 1つの機能につき300行以内のコード生成
- **段階的指示**: 一度に複数の機能ではなく、1つずつ明確に指示
- **フィードバックループ**: 各実装後に動作確認とフィードバック

### 1.2 コンテキスト明確化
- **現在の状況**: プロジェクトの進捗状況を常に明確に伝える
- **目標設定**: 各タスクの期待結果を具体的に定義
- **制約条件**: 技術的制約・時間的制約を事前に共有

### 1.3 品質保証重視
- **TDDファースト**: テスト→実装→リファクタリングの順序を厳守
- **コード規約準拠**: TypeScript・Python・React のベストプラクティス
- **即座のレビュー**: 生成コードは即座に動作確認

## 2. プロンプトエンジニアリング戦略

### 2.1 構造化プロンプト
```
目的: [何を実現したいか]
コンテキスト: [現在の状況・関連ファイル・依存関係]
指示: [具体的な実装内容]
期待結果: [期待する出力形式・動作]
制約: [技術制約・パフォーマンス要件]
```

### 2.2 技術仕様の明確化
- **API設計**: OpenAPIスキーマベースの設計
- **データフロー**: 入力→処理→出力の明確な定義
- **エラーハンドリング**: 例外ケースの事前定義

### 2.3 コード生成最適化
- **ファイル分割**: 責任範囲に応じた適切なファイル分割
- **依存関係**: import文・パッケージ依存の明確化
- **型安全性**: TypeScript・Pydantic型定義の活用

## 3. TDD + AI駆動開発ワークフロー

### 3.1 テストファースト開発
1. **要件定義**: ユーザーストーリー→受け入れテスト
2. **テスト生成**: AIによる包括的テストケース生成
3. **実装**: テストを満たす最小限のコード実装
4. **リファクタリング**: AIによるコード改善提案

### 3.2 AI支援テスト戦略
```python
# テスト生成時の指示例
"""
以下の機能のテストケースを生成してください：
- 正常系: 期待される入力での正常動作
- 異常系: エラーケース・境界値テスト
- エッジケース: 極端な値・空値・特殊文字
- 統合テスト: API間の連携テスト
"""
```

### 3.3 継続的品質改善
- **コードレビュー**: AIによるコード品質・セキュリティチェック
- **パフォーマンス**: レスポンス時間・メモリ使用量の監視
- **保守性**: 可読性・拡張性の継続的改善

## 4. FastAPI + React + LangGraph特化ルール

### 4.1 バックエンド開発（FastAPI）
- **API設計**: RESTful原則 + OpenAPI自動生成
- **非同期処理**: async/await の適切な活用
- **依存性注入**: FastAPIのDependsパターン活用
- **バリデーション**: Pydanticモデルによる型安全性

```python
# FastAPI実装時の標準パターン
from fastapi import FastAPI, Depends, HTTPException
from pydantic import BaseModel
import pytest

# 1. Pydanticモデル定義
class ChatRequest(BaseModel):
    message: str
    session_id: str

# 2. テスト実装
def test_chat_endpoint():
    # テストケース実装

# 3. API実装
@app.post("/chat")
async def chat(request: ChatRequest):
    # 実装
```

### 4.2 フロントエンド開発（React + TypeScript）
- **コンポーネント設計**: 単一責任原則・再利用性重視
- **状態管理**: useStateとuseContext の適切な使い分け
- **型安全性**: APIレスポンス型の厳密な定義
- **テスト**: React Testing Library + Jest

```typescript
// React実装時の標準パターン
import React from 'react';
import { render, screen } from '@testing-library/react';

// 1. 型定義
interface ChatMessage {
  id: string;
  content: string;
  timestamp: Date;
}

// 2. テスト実装
test('ChatComponent renders messages', () => {
  // テストケース
});

// 3. コンポーネント実装
const ChatComponent: React.FC<Props> = ({ messages }) => {
  // 実装
};
```

### 4.3 LangGraph統合
- **ワークフロー設計**: 状態遷移の明確な定義
- **エラーハンドリング**: 各ノードでの例外処理
- **デバッグ**: LangSmithによるトレース可視化

## 5. Docker環境特化ルール

### 5.1 コンテナ設計
- **マルチステージビルド**: 本番用最適化イメージ
- **セキュリティ**: 非rootユーザー・最小権限原則
- **開発効率**: ホットリロード・デバッグ環境

### 5.2 docker-compose構成
```yaml
# 開発環境の標準構成
services:
  backend:
    build: ./backend
    volumes:
      - ./backend:/app
    environment:
      - PYTHONPATH=/app
  frontend:
    build: ./frontend
    volumes:
      - ./frontend:/app
      - /app/node_modules
```

### 5.3 開発環境最適化
- **DevContainer**: VSCode統合開発環境
- **ライブリロード**: ファイル変更の即座反映
- **テスト環境**: CI/CD との一貫性確保

## 6. AI活用効率化テクニック

### 6.1 コード生成パターン
- **スケルトン生成**: 基本構造→詳細実装の段階的生成
- **パターン適用**: 既存の成功パターンの再利用
- **自動補完**: 型情報に基づく正確なコード補完

### 6.2 デバッグ支援
- **エラー解析**: エラーメッセージからの原因特定・解決策提示
- **ログ分析**: システムログからの問題箇所特定
- **パフォーマンス最適化**: ボトルネック特定・改善提案

### 6.3 ドキュメント自動生成
- **API仕様**: OpenAPIからの自動生成
- **README**: プロジェクト構造からの自動作成
- **コメント**: コードの意図を説明する適切なコメント生成

## 7. 開発効率最大化ルール

### 7.1 時間管理
- **ポモドーロ技術**: 25分集中→5分休憩のサイクル
- **タスク分割**: 大きなタスクを2時間以内の小タスクに分解
- **進捗可視化**: TODO管理ツールでの進捗追跡

### 7.2 知識管理
- **学習記録**: 新しい技術・パターンの記録
- **エラー辞書**: 遭遇したエラーと解決策の蓄積
- **ベストプラクティス**: 成功パターンのテンプレート化

### 7.3 チーム連携
- **コミット規約**: Conventional Commitsの採用
- **コードレビュー**: AIレビュー + 人間レビューの組み合わせ
- **知識共有**: 設計判断・技術選択の文書化

## 8. プロジェクト固有ルール

### 8.1 製造業ドメイン
- **専門用語**: 製造業固有の用語・概念の正確な理解
- **業務フロー**: 改善活動・品質管理プロセスの把握
- **データ形式**: 製造業で使用される標準的なファイル形式

### 8.2 セキュリティ・コンプライアンス
- **データ保護**: 機密情報の適切な取り扱い
- **アクセス制御**: 社内利用に適した認証・認可
- **監査ログ**: 利用状況の記録・追跡可能性

### 8.3 運用考慮事項
- **スケーラビリティ**: 将来的なユーザー増加への対応
- **保守性**: コードの可読性・修正容易性
- **監視**: システム稼働状況の可視化

---

**重要**: このルールセットは開発進行に合わせて継続的に更新・改善していく
